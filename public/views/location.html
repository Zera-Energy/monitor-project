<section id="locView">
  <div class="pageHeader">
    <h2 class="pageTitle">Devices Location</h2>
  </div>

  <!-- ìƒë‹¨ ìƒíƒœ/ê²€ìƒ‰/ë²„íŠ¼ ë°” -->
  <div class="locTop">
    <div class="locStats">
      <div class="locStat">ğŸ“ <b id="locWith">0</b> devices with location</div>
      <div class="locStat">ğŸ“ <b id="locWithout">0</b> without location</div>
    </div>

    <div class="locActions">
      <div class="locSearch">
        <input id="locSearchInput" class="locSearchInput" placeholder="Search location..." />
        <button id="locSearchBtn" class="locSearchBtn" type="button">ğŸ”</button>
      </div>

      <button id="btnFitAll" class="locBtn light" type="button">ğŸ—º Fit All</button>

      <div class="locDrop">
        <button id="btnSetLoc" class="locBtn amber" type="button">ğŸ“ Set Location â–¾</button>
        <div class="locMenu" id="locMenu" hidden>
          <button class="locMenuItem" type="button" data-action="set-mode">Set mode</button>
          <button class="locMenuItem" type="button" data-action="clear-mode">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ì§€ë„ -->
  <div class="locMapWrap">
    <div id="map" class="locMap"></div>

    <!-- ìš°ì¸¡í•˜ë‹¨ Status ì¹´ë“œ -->
    <div class="locLegend">
      <div class="locLegendTitle">Status</div>
      <div class="locLegendRow"><span class="dot green"></span> Online</div>
      <div class="locLegendRow"><span class="dot gray"></span> Offline</div>
    </div>
  </div>

  <!-- âœ… ì´ viewì—ì„œë§Œ ì‹¤í–‰ -->
  <script data-view-script>
    // ì™¸ë¶€ JS ë¡œë“œ (Leaflet + view.location.js)
    // app.jsê°€ moduleì´ë¼ë„ ì´ view-scriptëŠ” ê·¸ëƒ¥ ì‹¤í–‰ë¨

    function loadScriptOnce(src, id){
      return new Promise((resolve) => {
        if (id && document.getElementById(id)) return resolve();
        const s = document.createElement("script");
        if (id) s.id = id;
        s.src = src;
        s.onload = () => resolve();
        s.onerror = () => resolve(); // ì‹¤íŒ¨í•´ë„ í˜ì´ì§€ëŠ” ì‚´ë¦¼
        document.body.appendChild(s);
      });
    }

    (async () => {
      // Leaflet JS (CDN)
      await loadScriptOnce("https://unpkg.com/leaflet@1.9.4/dist/leaflet.js", "leaflet-js");
      // ìš°ë¦¬ view ì „ìš© JS
      await loadScriptOnce("./js/view.location.js", "view-location-js");

      if (typeof window.initLocationView === "function") {
        window.initLocationView();
      }
    })();
  </script>
</section>
